<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–ü—Ä–æ—Ñ–∏–ª—å ‚Äî TeamTrack</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-800 font-sans">

  <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
  <header class="bg-white shadow mb-6">
    <div class="container mx-auto px-6 py-4 flex justify-between items-center">
      <a href="/dashboard" class="text-indigo-600 hover:underline">‚Üê –ù–∞–∑–∞–¥</a>
      <h1 class="text-xl font-bold">TeamTrack</h1>
    </div>
  </header>

  <!-- –ö–æ–Ω—Ç–µ–Ω—Ç -->
  <main class="container mx-auto px-6">

    <!-- –ë–ª–æ–∫ –ø—Ä–æ—Ñ–∏–ª—è -->
    <div class="bg-white p-6 rounded shadow mb-6">
      <h2 class="text-2xl font-bold mb-2">üë§ –ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</h2>
      <p class="text-gray-700 mb-2">üìß Email: <span id="userEmail">–ó–∞–≥—Ä—É–∑–∫–∞...</span></p>
      <p class="text-gray-600 text-sm">üìÖ –î–∞—Ç–∞ –≤—Ö–æ–¥–∞: <span id="loginDate">‚Äì</span></p>
      <button onclick="logout()" class="mt-4 bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">üîò –í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞</button>
    </div>

    <!-- –ü—Ä–æ–µ–∫—Ç—ã -->
    <div class="bg-white p-6 rounded shadow">
      <h3 class="text-xl font-semibold mb-4">üìã –ú–æ–∏ –ø—Ä–æ–µ–∫—Ç—ã</h3>
      <ul id="projectList" class="space-y-2 text-indigo-600">
        <li>–ó–∞–≥—Ä—É–∑–∫–∞...</li>
      </ul>
    </div>

  </main>

  <!-- Firebase -->
  <script type="module">
    import { auth, db, onAuthStateChanged } from "/static/firebase.js";
    import { collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js";
    import { signOut } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-auth.js";

    const emailEl = document.getElementById("userEmail");
    const loginDateEl = document.getElementById("loginDate");
    const projectList = document.getElementById("projectList");

    function logout() {
      signOut(auth).then(() => {
        window.location.href = "/login";
      });
    }

    onAuthStateChanged(auth, async (user) => {
      if (user) {
        emailEl.textContent = user.email;
        loginDateEl.textContent = new Date(user.metadata.lastSignInTime).toLocaleString();

        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–µ–∫—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        const q = query(collection(db, "projects"), where("owner", "==", user.uid));
        const querySnapshot = await getDocs(q);

        projectList.innerHTML = "";
        if (querySnapshot.empty) {
          projectList.innerHTML = "<li class='text-gray-500'>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –ø—Ä–æ–µ–∫—Ç–æ–≤</li>";
        }

        querySnapshot.forEach(doc => {
          const data = doc.data();
          const li = document.createElement("li");
          li.innerHTML = `<a href="/project.html?id=${doc.id}" class="hover:underline">${data.name}</a>`;
          projectList.appendChild(li);
        });

      } else {
        window.location.href = "/login";
      }
    });
  </script>
</body>
</html>
