

<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>TeamTrack ‚Äî –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="icon" href="/static/favicon.ico">
</head>
<body class="bg-gray-100 text-gray-800 font-sans">

  <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
  <header class="bg-white shadow">
    <div class="container mx-auto px-6 py-4 flex justify-between items-center">
      <h1 class="text-2xl font-bold text-indigo-600">TeamTrack</h1>
      <nav class="space-x-4 flex items-center">
        <a href="/" class="text-gray-600 hover:text-indigo-600">üè† –ì–ª–∞–≤–Ω–∞—è</a>
        <a href="/profile" class="text-gray-600 hover:text-indigo-600">üë§ –ü—Ä–æ—Ñ–∏–ª—å</a>
      </nav>
    </div>
  </header>

  <!-- –ö–æ–Ω—Ç–µ–Ω—Ç -->
  <main class="container mx-auto px-6 py-10">
    <h2 class="text-3xl font-bold mb-6">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, <span id="username">–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</span>!</h2>

    <!-- –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ -->
    <div class="bg-white p-6 rounded-lg shadow mb-6">
      <h3 class="text-xl font-semibold mb-4">–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç</h3>
      <input type="text" id="projectName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞" class="border p-2 w-full mb-2" />
      <textarea id="projectDesc" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞" class="border p-2 w-full mb-2"></textarea>
      <input type="text" id="projectMembers" placeholder="–£—á–∞—Å—Ç–Ω–∏–∫–∏ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)" class="border p-2 w-full mb-4" />
      <button onclick="createProject()" class="bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700">–°–æ–∑–¥–∞—Ç—å</button>
    </div>

    <!-- –°–ø–∏—Å–æ–∫ –ø—Ä–æ–µ–∫—Ç–æ–≤ -->
    <h3 class="text-2xl font-bold mb-4">–ú–æ–∏ –ø—Ä–æ–µ–∫—Ç—ã</h3>
    <div id="projectsList" class="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
      <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ –ø—Ä–æ–µ–∫—Ç–æ–≤ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å -->
    </div>
  </main>

  <!-- Firebase –∏ –ª–æ–≥–∏–∫–∞ -->
<script type="module">
  import { auth, db, onAuthStateChanged } from "/static/firebase.js";
  import {
    collection, addDoc, query, where, onSnapshot, serverTimestamp
  } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js";


    let currentUser = null;

    // –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
    window.createProject = async function () {
      const name = document.getElementById("projectName").value.trim();
      const desc = document.getElementById("projectDesc").value.trim();
      const membersRaw = document.getElementById("projectMembers").value.trim();

      if (!name || !currentUser) return;

      const members = membersRaw
        ? membersRaw.split(",").map(e => e.trim()).filter(e => e)
        : [];

      // –í–∫–ª—é—á–∞–µ–º —Å–∞–º–æ–≥–æ —Å–æ–∑–¥–∞—Ç–µ–ª—è –≤ —Å–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
      if (!members.includes(currentUser.email)) {
        members.push(currentUser.email);
      }

      await addDoc(collection(db, "projects"), {
        name,
        description: desc,
        members,
        owner: currentUser.uid,
        createdAt: serverTimestamp()
      });

      // –û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º—ã
      document.getElementById("projectName").value = "";
      document.getElementById("projectDesc").value = "";
      document.getElementById("projectMembers").value = "";
    };

    // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–µ–∫—Ç–æ–≤
    onAuthStateChanged(auth, user => {
      if (user) {
        currentUser = user;
        document.getElementById("username").textContent = user.email.split("@")[0];

        // –ó–∞–ø—Ä–æ—Å –≤—Å–µ—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤, –≥–¥–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —è–≤–ª—è–µ—Ç—Å—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–º
        const q = query(collection(db, "projects"), where("members", "array-contains", user.email));
        onSnapshot(q, snapshot => {
          const container = document.getElementById("projectsList");
          container.innerHTML = "";
          snapshot.forEach(doc => {
            const data = doc.data();
            const memberList = data.members.join(", ");

            container.innerHTML += `
              <a href="/project.html?id=${doc.id}" class="block bg-white p-4 rounded shadow hover:shadow-md transition">
                <h4 class="text-lg font-bold mb-1">${data.name}</h4>
                <p class="text-gray-600 text-sm mb-1">${data.description || "–ë–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è"}</p>
                <p class="text-sm text-gray-500">üë• –£—á–∞—Å—Ç–Ω–∏–∫–∏: ${memberList}</p>
                <p class="text-xs text-gray-400 mt-2">‚Üí –ü–µ—Ä–µ–π—Ç–∏ –∫ –ø—Ä–æ–µ–∫—Ç—É</p>
              </a>
            `;
          });

          if (snapshot.empty) {
            container.innerHTML = "<p class='text-gray-500'>–ù–µ—Ç –ø—Ä–æ–µ–∫—Ç–æ–≤, –≤ –∫–æ—Ç–æ—Ä—ã—Ö –≤—ã —É—á–∞—Å—Ç–≤—É–µ—Ç–µ.</p>";
          }
        });
      } else {
        window.location.href = "/login";
      }
    });
  </script>
</body>
</html>
